# Development Plan

This plan is optimized for "daily use" and long-term maintainability. Each milestone should keep the tool usable.

## v0.1 (Shipped)

Done:
- CLI: `init`, `scan`, `log`, `context`, `print`
- Repo scan (git-aware) -> `.repo-memory/manifest.json` + `.repo-memory/index.json`
- Context Pack generator -> `.repo-memory/context.md`

## v0.2 (Make Memory More Useful) (Shipped)

Goals:
- Produce a better "project memory" without tying to any specific repo type.
- Reduce manual work to keep rules/todos/journal consistent.

Done:
- Add `rmemo status` (+ `--format md|json` + `--mode brief|full`):
  - Summarize "Next / Blockers / Recent log" from `.repo-memory/*`
  - Output should be pasteable to issues/PR descriptions
- Improve scan heuristics:
  - Detect monorepo candidates (workspaces, pnpm, turborepo, packages/apps)
  - Detect common app folders (web/admin/backend/miniapp/mp) as hints only
  - Detect API contract files and doc roots (openapi/swagger/docs)
- Add `rmemo start` as a daily entrypoint (scan + context + status brief)
- Add todo helpers: `rmemo todo add|block|ls`

## v0.3 (Rules Become Enforceable) (Shipped)

Goals:
- Prevent "AI drift" by making key conventions executable.

Done:
- Add `.repo-memory/rules.json` (generated by `init`):
  - Structure rules: required dirs/files, forbidden paths, naming regexes
- Add `rmemo check`:
  - Validate repo against rules.json (no network)
  - Exit code for CI usage
  - Print actionable diff-like messages
- Add forbidden content scanning: `forbiddenContent`
- Add `--staged` mode (pre-commit optimized, reads staged content from git index)
- Add `rmemo hook install`:
  - Install a pre-commit hook to run `rmemo check` (opt-in)

## v0.4 (Workflow: Start/Stop The Day) (Shipped)

Goals:
- Make the daily routine effortless.

Done:
- Add `rmemo done`:
  - Promptless mode: take stdin to append to journal
  - Optionally extract "next steps" into todos.md
- Unify journal format for `log/done`
- Add todo lifecycle: `rmemo todo done|unblock` (remove by index)

## v0.5 (Polish + Adoption) (Shipped)

Goals:
- Make it easy for others to adopt.

Done:
- Add packaging metadata:
  - repository/homepage/bugs fields
  - `files` allowlist for npm
  - `npm pack --dry-run` in CI
- Prepare npm publishing:
  - scoped package: `@xiaofandegeng/rmemo`
  - release workflows: dry-run + publish
- Add docs:
  - "How I use this with Cursor/Claude/ChatGPT" (docs/USAGE.*)
  - Built-in templates + how to apply (web admin / miniapp)
- Add `CHANGELOG.md` + `CONTRIBUTING.md` + `RELEASING.md`
- Update docs to include npm install usage

## v0.6 (Optional)

Done:
- `rmemo scan --format md|json` to print scan results to stdout
- `rmemo check` output improvements (grouping + hints)
- `rmemo check --format json`

Remaining ideas:
- `rmemo scan --format md` optionally include a short "subprojects summary" table
- `rmemo check` output: optional `--max-violations <n>` and show stable ordering

## v0.7 (AI Tool Integration) (In Progress)

Goals:
- Make project memory "stick" inside AI tools that support repo-local instruction files.
- Keep instruction files generated and consistent across days and contributors.

Done:
- Add `rmemo sync` to generate instruction files from `.repo-memory/`:
  - `AGENTS.md`
  - `.github/copilot-instructions.md`
  - `.cursor/rules/rmemo.mdc`
- Add `--check/--dry-run/--targets/--force` flags and smoke tests

## v0.8 (Always-On Workflow) (In Progress)

Goals:
- Make the workflow "set and forget" for each repo.
- Keep instruction files fresh automatically via git hooks.

Done:
- Add `.repo-memory/config.json` to store sync defaults (targets).
- Add `rmemo setup` to install hooks:
  - `pre-commit`: `rmemo check --staged` (blocking)
  - `post-commit/post-merge/post-checkout`: `rmemo sync` (non-blocking)
- Add `rmemo setup --check` and `rmemo setup --uninstall` for audit and rollback

## v0.9 (Handoff Pack) (In Progress)

Goals:
- Generate a single, paste-ready markdown "handoff" for AI sessions.
- Include brief status, recent journal, and git change summary.

Done:
- Add `rmemo handoff` to update scan/context and generate `.repo-memory/handoff.md`

## v1.0 (PR Assistant) (In Progress)

Goals:
- Generate a PR-ready markdown summary (commits/files + brief status).
- Make it easy to paste into GitHub/GitLab PR descriptions.

Done:
- Add `rmemo pr` to generate `.repo-memory/pr.md` (supports `--base`, `--format json`, `--no-refresh`)

## v1.1 (GitHub PR Automation) (In Progress)

Goals:
- Auto-run `rmemo check` on pull requests.
- Auto-generate PR summaries and post them as artifacts and PR comments.

Done:
- Add GitHub Actions workflow: `.github/workflows/pr-assistant.yml`

## v1.2 (Watch Mode) (In Progress)

Goals:
- Keep `.repo-memory/context.md` and instruction files fresh while you work.
- Avoid requiring external deps (no chokidar).

Done:
- Add `rmemo watch` (poll-based) with `--interval`, `--once`, and `--no-sync`

## v1.3 (Monorepo Workspaces) (In Progress)

Goals:
- Make `--root <subdir>` behave correctly in git repos (scope file listing).
- Provide a first-class monorepo UX to run rmemo commands in subprojects.

Done:
- Scope `git ls-files` to `--root` subdir when `--root` is inside a git repo
- Add `rmemo ws` (workspace helper) to list/detect subprojects and run commands inside them

## v1.4 (Workspace Batch) (In Progress)

Goals:
- Batch-generate handoff/pr/sync/start across all detected subprojects.
- Write a monorepo-level summary file for quick navigation.

Done:
- Add `rmemo ws batch ...` and write `.repo-memory/ws.md` at repo root

## v1.5 (Profiles) (Shipped)

Goals:
- Make adoption near-zero effort for common repo types (admin web, miniapp, backend, monorepo).
- Encode team defaults in a reusable profile: rules, todos seed, config defaults.
- Allow safe upgrades over time.

Done:
- Add `rmemo profile ls/describe/apply`
- Add `rmemo init --auto` (detect + apply recommended profile)
- Add profile drift + upgrades:
  - `rmemo profile check` (drift report)
  - `rmemo profile upgrade` (re-apply template + backups)

## v1.6 (Sessions) (Shipped)

Goals:
- Make daily work trackable as a sequence of "sessions" (start -> notes -> end).
- Each session should produce a deterministic handoff pack for AI, without manual copy/paste.

Done:
- Add `rmemo session start|note|end|ls|show`
- Each session stored in `.repo-memory/sessions/<id>/`:
  - `meta.json` (schema, startedAt/endedAt, git branch/head when available)
  - `notes.md` (human notes)
  - `handoff.md` + `context.md` snapshots (generated at end)

## v1.7 (Repo Memory API) (Shipped)

Goals:
- Let AI tools fetch repo memory without copy/paste.
- Keep it local-first and safe (no outbound network, read-only by default).

Done:
- Add `rmemo serve` (local HTTP API; read-only by default)
- Add `GET /ui` (single-file local dashboard; unauthenticated)
- Add `GET /events` (SSE stream) and `rmemo serve --watch` to keep memory fresh automatically
- Endpoints:
  - `GET /status` (json|md)
  - `GET /context`
  - `GET /manifest` + `GET /index`
  - `GET /rules` + `GET /rules.json`
  - `GET /todos` (md|json)
  - `GET /handoff` + `GET /pr` (serve existing files; optional refresh)
  - `GET /journal` + `GET /journal/YYYY-MM-DD.md`
  - `GET /search?q=...` (search rules/todos/context/manifest/journal)
- Optional write endpoints (gated by `--allow-write` and token):
  - `POST /todos/next|blockers`
  - `POST /todos/next/done|blockers/unblock`
  - `POST /log`, `POST /sync`, `POST /embed/auto`
- Token auth support: `--token` / `RMEMO_TOKEN`

## v1.8 (MCP Server) (Planned)

Goals:
- Provide the same capabilities over stdio for AI tools that support MCP.

Done:
 - Add `rmemo mcp` stdio server with tools:
   - Read tools: `rmemo_status`, `rmemo_context`, `rmemo_rules`, `rmemo_todos`, `rmemo_handoff`, `rmemo_pr`, `rmemo_search`, `rmemo_focus`
   - Write tools (disabled by default; enable with `--allow-write`):
     - `rmemo_todo_add`, `rmemo_todo_done`, `rmemo_log`, `rmemo_sync`, `rmemo_embed_auto`

## v1.9 (Integrations + Doctor) (In Progress)

Goals:
- Reduce friction when integrating with IDEs/agents (especially MCP clients running with restricted PATH).
- Provide a first-class way to debug install/version conflicts.

Done:
- Add `rmemo integrate` to output paste-ready MCP config snippets:
  - `rmemo integrate antigravity` (JSON snippet for Antigravity raw config)
- Add `rmemo doctor` to print diagnostics (node/bin/registry/config) and common fixes.

## v2.0 (Persistent Workbench) (In Progress)

Goals:
- Turn `rmemo serve` into a long-running local workbench with live events and runtime controls.

Done:
- Add SSE stream `GET /events` with keepalive + Last-Event-ID replay.
- Add watch runtime status API `GET /watch`.
- Add watch controls: `POST /watch/start`, `POST /watch/stop`.
- Add one-shot refresh trigger: `POST /refresh`.
- Add events export: `GET /events/export?format=json|md&limit=...`.
- Add diagnostics bundle export: `GET /diagnostics/export?format=json|md` (status + watch + events).
- Add embeddings operations surface:
  - `rmemo embed status` (CLI health/status summary)
  - `rmemo embed plan` (CLI preview of reuse/embed actions)
  - `GET /embed/status?format=json|md`
  - `GET /embed/plan?format=json|md`
  - `POST /embed/build` (trigger build from config or overrides)
  - Parallel embedding workers for mock provider (`parallelism`) + OpenAI batch throttle (`batchDelayMs`)
  - Build progress event stream over SSE: `embed:build:start|progress|ok|err`
  - Background embeddings job queue:
    - `POST /embed/jobs`, `GET /embed/jobs`, `GET /embed/jobs/:id`, `POST /embed/jobs/:id/cancel`
    - SSE events: `embed:job:queued|start|progress|ok|err|canceled`
    - Scheduler config: `GET/POST /embed/jobs/config {maxConcurrent}`
    - Orchestration policy: `priority` + `maxRetries/retryDelayMs` + error classification (`auth/rate_limit/network/config/runtime`)
  - Task governance v2 for embed jobs:
    - Retry templates (`conservative|balanced|aggressive`) + configurable default template/priority
    - Adaptive retry policy fields (`fixed|exponential`, `maxDelayMs`, `backoffMultiplier`, `jitterRatio`)
    - Failure clustering API (`GET /embed/jobs/failures`) for repeated-error analysis
    - One-click retry APIs: `POST /embed/jobs/:id/retry`, `POST /embed/jobs/retry-failed`
    - MCP governance tools: `rmemo_embed_jobs_failures`, `rmemo_embed_job_retry`, `rmemo_embed_jobs_retry_failed`
    - UI governance panel actions: failures view + retry single/batch
  - Task governance v3 (auto policy engine):
    - Governance report API: `GET /embed/jobs/governance` (sample/failureRate/errorClassCounts + recommendations)
    - Auto-governance config API: `POST /embed/jobs/governance/config`
    - Manual recommendation apply API: `POST /embed/jobs/governance/apply`
    - Auto action engine with cooldown:
      - auto-downscale on unstable windows (rate-limit/network/auth/config heavy)
      - auto-recover on healthy windows (gradual concurrency restore + retry-template relax)
    - New governance events: `embed:jobs:governance:action`, `embed:jobs:governance:skip`
    - MCP governance tools:
      - `rmemo_embed_jobs_governance`
      - `rmemo_embed_jobs_governance_config`
      - `rmemo_embed_jobs_governance_apply`
  - Task governance v4 (policy versioning + rollback):
    - Auto version snapshots whenever governance/scheduler policy changes
    - Governance history API: `GET /embed/jobs/governance/history`
    - Governance rollback API: `POST /embed/jobs/governance/rollback`
    - Governance version events: `embed:jobs:governance:versioned`, `embed:jobs:governance:rollback`
    - MCP tools:
      - `rmemo_embed_jobs_governance_history`
      - `rmemo_embed_jobs_governance_rollback`
    - UI support:
      - policy history viewer
      - rollback by version id
  - Task governance v5 (policy simulator + impact preview):
    - Simulation API: `POST /embed/jobs/governance/simulate`
    - Supports:
      - `mode=recommend` (recommendation-only preview)
      - `mode=apply_top` (predict effective patch + predicted afterConfig, without mutating runtime)
    - Supports hypothetical policy patch inputs (window/threshold/retryTemplate/concurrency flags)
    - MCP simulation tool: `rmemo_embed_jobs_governance_simulate`
    - UI simulation controls:
      - mode selector
      - one-click dry-run output panel
  - Task governance v6 (strategy benchmark replay):
    - Benchmark API: `POST /embed/jobs/governance/benchmark`
    - Replay multiple candidate policies across multiple governance windows
    - Produce score ranking + recommendation (with rationale)
    - MCP benchmark tool: `rmemo_embed_jobs_governance_benchmark`
    - UI benchmark controls and result panel
  - Task governance v7 (benchmark auto-adopt + threshold gates):
    - Config extensions:
      - `benchmarkAutoAdoptEnabled`
      - `benchmarkAutoAdoptMinScore`
      - `benchmarkAutoAdoptMinGap`
    - API:
      - `POST /embed/jobs/governance/benchmark/adopt`
    - MCP:
      - `rmemo_embed_jobs_governance_benchmark_adopt`
      - `rmemo_embed_jobs_governance_config` supports benchmark auto-adopt fields
    - Events:
      - `embed:jobs:benchmark:adopt`
      - `embed:jobs:benchmark:skip`
    - UI:
      - auto-adopt config inputs and one-click benchmark+adopt action
- Workspace intelligence v2 (cross-workspace focus orchestration):
  - New command:
    - `rmemo ws focus <workspace> <query>`
    - `rmemo ws batch focus <query>`
  - Support `--mode semantic|keyword` and `--format md|json`
  - Batch output includes per-workspace hit count + top hit summary
  - Persist batch summary to `.repo-memory/ws.md` for next-day handoff context
- Workspace intelligence v3 (serve + MCP aggregation APIs):
  - HTTP:
    - `GET /ws/list` list subprojects (supports `only=...`)
    - `GET /ws/focus?q=...` aggregate focus results across subprojects
  - MCP:
    - `rmemo_ws_list`
    - `rmemo_ws_focus`
  - Shared core:
    - `src/core/workspaces.js` for reusable workspace listing + batch focus
- Workspace intelligence v4 (UI workspace hub):
  - UI panel:
    - `WS List` (calls `/ws/list`)
    - `WS Focus` (calls `/ws/focus`)
    - `only` filter field for subproject subset querying
  - Reuse existing global query/mode controls for workspace focus
- Workspace intelligence v5 (focus snapshots + drift compare):
  - Persist workspace-focus snapshots under `.repo-memory/ws-focus/snapshots/*.json`
  - CLI:
    - `rmemo ws batch focus ... --save --compare-latest --tag <name>`
    - `rmemo ws focus-history list|compare`
  - HTTP:
    - `/ws/focus` supports `save=1` and `compareLatest=1`
    - `GET /ws/focus/snapshots`
    - `GET /ws/focus/compare`
  - MCP:
    - `rmemo_ws_focus_snapshots`
    - `rmemo_ws_focus_compare`
- Workspace intelligence v6 (focus drift report):
  - Build report from snapshots with change classification and impact ranking
  - CLI:
    - `rmemo ws focus-history report [<fromId> <toId>] [--format md|json] [--max-items <n>]`
    - if snapshot ids are omitted, compare latest two snapshots automatically
  - HTTP:
    - `GET /ws/focus/report?from=<id>&to=<id>&format=json|md&maxItems=<n>`
  - MCP:
    - `rmemo_ws_focus_report`
  - UI:
    - `WS Report` button (uses selected output tab as md/json format)
- Workspace intelligence v7 (drift report registry + recall):
  - Persist generated drift reports under `.repo-memory/ws-focus/reports/*.json`
  - CLI:
    - `rmemo ws focus-history report ... --save-report --report-tag <name>`
    - `rmemo ws report-history list|show`
  - HTTP:
    - `/ws/focus/report` supports `save=1&tag=...`
    - `GET /ws/focus/reports`
    - `GET /ws/focus/report-item?id=<reportId>`
  - MCP:
    - `rmemo_ws_focus_report_history`
    - `rmemo_ws_focus_report_get`
  - UI:
    - `WS Reports` list + `Show WS Report` by report id
- Workspace intelligence v8 (trend board):
  - Aggregate saved drift reports by `mode::query` key for longitudinal analysis
  - CLI:
    - `rmemo ws trend [--limit-groups <n>] [--limit-reports <n>]`
    - `rmemo ws trend show <trendKey> [--limit <n>]`
  - HTTP:
    - `GET /ws/focus/trends?limitGroups=<n>&limitReports=<n>`
    - `GET /ws/focus/trend?key=<trendKey>&limit=<n>`
  - MCP:
    - `rmemo_ws_focus_trends`
    - `rmemo_ws_focus_trend_get`
  - UI:
    - `WS Trends` + `Show WS Trend` controls
- Workspace intelligence v9 (trend alerts + governance linkage):
  - Alert policy for trend drift thresholds (`minReports`, regressed/errors, avg/max changed)
  - CLI:
    - `rmemo ws alerts`
    - `rmemo ws alerts config show|set`
  - HTTP:
    - `GET /ws/focus/alerts`
    - `GET/POST /ws/focus/alerts/config`
    - `POST /ws/focus/alerts/check?autoGovernance=1`
  - MCP:
    - `rmemo_ws_focus_alerts`
    - `rmemo_ws_focus_alerts_config`
    - `rmemo_ws_focus_alerts_config_set` (write)
    - `rmemo_ws_focus_alerts_check` (write; optional auto-governance)
  - UI:
    - `WS Alerts` panel
    - alert policy load/save and one-click auto-governance check
- Workspace intelligence v10 (alert timeline + RCA pack):
  - Persist alert-check incidents under `.repo-memory/ws-focus/alerts-history.json`
  - CLI:
    - `rmemo ws alerts check`
    - `rmemo ws alerts history [--limit <n>] [--key <trendKey>] [--level high|medium]`
    - `rmemo ws alerts rca [--incident <id>] [--format md|json]`
  - HTTP:
    - `GET /ws/focus/alerts/history`
    - `GET /ws/focus/alerts/rca`
    - `POST /ws/focus/alerts/check` now records incident ids for traceability
  - MCP:
    - `rmemo_ws_focus_alerts_history`
    - `rmemo_ws_focus_alerts_rca`
    - `rmemo_ws_focus_alerts_check` now records and returns incident id
  - UI:
    - `WS Alerts History` and `WS Alerts RCA` actions
    - incident id input for RCA anchor selection
- Add UI control panels for live events, watch status/control, and refresh actions.
- `rmemo mcp` MCP stdio server (JSON-RPC, one JSON per line; logs to stderr)
- Tools:
  - `rmemo_status`
  - `rmemo_context` (supports refresh)
  - `rmemo_rules`
  - `rmemo_todos` (md/json)
  - `rmemo_handoff` (md/json, supports refresh)
  - `rmemo_pr` (md/json, supports refresh)
  - `rmemo_search` (keyword search)
  - `rmemo_embed_status` (index/config/up-to-date status)
  - `rmemo_embed_plan` (preview next build actions)
  - `rmemo_embed_build` (write tool; requires `--allow-write`)
  - `rmemo_embed_jobs` / `rmemo_embed_job_enqueue` / `rmemo_embed_job_cancel` (MCP process-local queue)
  - `rmemo_embed_jobs_config` (get/set queue concurrency)

## v1.9 (Semantic Memory) (Planned)

Goals:
- Make "memory retrieval" work even when you don't remember the exact keyword.
- Keep it local-first: build an embeddings index under `.repo-memory/` and search it.
- Expose the same capability over CLI/HTTP/MCP.

Planned:
- `rmemo embed build`:
  - Build `.repo-memory/embeddings/index.json`
  - Provider options: `mock` (default, deterministic) and `openai` (optional)
- `rmemo embed search <query>`:
  - Return top-k matching chunks with scores and snippets
- HTTP:
  - `GET /search?mode=semantic&q=...` uses the embeddings index
- MCP:
  - Extend `rmemo_search` to support `mode=semantic`
